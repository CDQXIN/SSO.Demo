@{
    ViewData["Title"] = "用户列表";
}
@using SSO.Demo.Toolkits.Extension
@using SSO.Demo.Toolkits.Model
@using SSO.Demo.Web1.Model.User
@model PageListParam<ListParam>

@Html.LayerUiDateTimePickerFor(a=>a.Params.EndCreateDateTime)
<form id="form_userSearch">
    <div class="layui-inline">
        <input class="layui-input" placeholder="主键" name="Params.UserId" autocomplete="off">
    </div>
    <div class="layui-inline">
        <input class="layui-input" placeholder="用户名" name="Params.UserName" autocomplete="off">
    </div>
    <div class="layui-inline">
        <input class="layui-input" id="Params_BeganCreateDateTime" name="Params.BeganCreateDateTime" placeholder="开始创建时间" type="text">
    </div>
    <div class="layui-inline">
        <input class="layui-input" id="Params_EndCreateDateTime" name="Params.EndCreateDateTime" placeholder="结束创建时间" type="text">
    </div>
    <input id="btn_search" class="layui-btn" value="搜索" type="button"/>
    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
</form>

<table class="layui-table" lay-data="{height:'full-335', url:'/user/list', page:true, id:'table_userlist'}" lay-filter="user-container">
    <thead>
    <tr>
        <th lay-data="{field:'userId', checkbox: true,fixed: true}"></th>
        <th lay-data="{fixed: true, width:160, align:'center', toolbar: '#toolBar'}">操作</th>
        <th lay-data="{field:'userId', width:120}">主键</th>
        <th lay-data="{field:'userName', width:120}">用户名</th>
        <th lay-data="{field:'createDateTime', width:200}">创建时间</th>
    </tr>
    </thead>
</table>

<script type="text/html" id="toolBar">
    <a class="layui-btn layui-btn-mini" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-mini" lay-event="del">删除</a>
</script>

@section Scripts{
    <script>
        layui.use('table',
            function() {
                var table = layui.table;
                var $ = layui.$;

                var reloadForm = function() {
                    var formParams = $("#form_userSearch").formSerialize();

                    table.reload('table_userlist',
                        {
                            where: formParams
                        });
                }
                //查询按钮
                $('#form_userSearch #btn_search').on('click',
                    reloadForm);

                //监听表格工具栏
                table.on('tool(user-container)',
                    function(obj) {
                        var data = obj.data;
                        var userId = data.userId;
                        if (obj.event === 'del') {
                            layer.confirm('是否确认删除',
                                function(index) {
                                    $.post("/user/delete",
                                        { userid: userId },
                                        function(result) {
                                            if (result.success) {
                                                reloadForm();
                                                layer.close(index);
                                                layer.msg(result.message);
                                            } else
                                                layer.msg(result.message);
                                        });
                                });
                        } else if (obj.event === 'edit') {
                            layer.open({
                                type: 2,
                                skin: 'layui-layer-rim', //加上边框
                                area: ['420px', '240px'], //宽高
                                content: '/user/add'
                            });

                        }
                    });
            });

        layui.use('laydate',
            function() {
                var laydate = layui.laydate;

                laydate.render({
                    elem: '#Params_BeganCreateDateTime',
                    type: 'datetime'
                });
            });

        layui.use('laydate',
            function() {
                var laydate = layui.laydate;

                laydate.render({
                    elem: '#Params_EndCreateDateTime',
                    type: 'datetime'
                });
            });
    </script>
}